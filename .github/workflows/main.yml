name: Sync Dashboard from Google Drive                                                                                                
                                                                                                                                        
on:                                                                                                                                   
    schedule:                                                                                                                           
      - cron: '0 */3 * * *'                                                                                                             
    workflow_dispatch:

permissions:
  contents: write
                                                                                                                                        
jobs:                                                                                                                                 
    sync:                                                                                                                               
      runs-on: ubuntu-latest                                                                                                            
      steps:                                                                                                                            
        - uses: actions/checkout@v4                                                                                                     
        - uses: actions/setup-python@v5                                                                                                 
          with:                                                                                                                         
            python-version: '3.11'                                                                                                      
        - run: pip install pyyaml                                                                                                       
        - uses: AnimMouse/setup-rclone@v1                                                                                               
          with:                                                                                                                         
            rclone_config: ${{ secrets.RCLONE_CONFIG }}                                                                                 
        - run: rclone sync wscontentdrive:Content ./Content --exclude ".DS_Store" --exclude "*.tmp" -v                                  
        - run: python scripts/generate_dashboard_data.py                                                                                
        - run: |                                                                                                                        
            git config user.name "GitHub Action"                                                                                        
            git config user.email "action@github.com"                                                                                   
            git add data.json                                                                                                           
            git diff --staged --quiet || git commit -m "Auto-update"                                                                    
            git push
